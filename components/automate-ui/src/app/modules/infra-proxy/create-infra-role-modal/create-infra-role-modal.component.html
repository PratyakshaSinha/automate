<chef-modal [visible]="visible" (closeModal)="closeCreateModal()">
  <div class="text-right">
    <h2 slot="title">Create Role</h2>
  </div>
  <div class="flex-container">
    <mat-horizontal-stepper [linear]="false" #stepper labelPosition="bottom">
      <mat-step [stepControl]="firstFormGroup" (click)="$event.stopPropagation()">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>Basic</ng-template>
          <div class="input-margin">
            <chef-form-field>
              <label>
                <span class="label">Name <span aria-hidden="true">*</span></span>
                <input chefInput formControlName="name" type="text" id="name-input" (keyup)="handleInput($event)" autocomplete="off"/>
              </label>
              <chef-error
                *ngIf="(firstFormGroup.get('name').hasError('required') || firstFormGroup.get('name').hasError('pattern')) && firstFormGroup.get('name').dirty">
                Display Name is required.
              </chef-error>
              <chef-error *ngIf="conflictError">
                Role "{{firstFormGroup.get('name').value}}" already exists.
              </chef-error>
            </chef-form-field>
          </div>
          <div class="input-margin">
            <chef-form-field>
              <label>
                <span class="label">Description <span aria-hidden="true">*</span></span>
                <textarea chefInput name="description" id="description" formControlName="description" autofocus></textarea>
              </label>
              <chef-error
                *ngIf="(firstFormGroup.get('description').hasError('required') || firstFormGroup.get('description').hasError('pattern')) && firstFormGroup.get('description').dirty">
                Description is required.
              </chef-error>
            </chef-form-field>
          </div>
          <div class="button-bar-box">
            <chef-button tertiary (click)="closeCreateModal()">Cancel</chef-button>
            <button chef-button mat-button matStepperPrevious primary class="primary" disabled>Previous</button>
            <button chef-button mat-button matStepperNext primary class="primary" [disabled]="!firstFormGroup?.valid">Next</button>
            <chef-button [disabled]="!firstFormGroup?.valid || conflictError"  primary id="create-button-object-modal" (click)="createRole()">
              <chef-loading-spinner *ngIf="creating"></chef-loading-spinner>
              <span *ngIf="!creating">Create Role</span>
              <span *ngIf="creating">Creating Role...</span>
            </chef-button>
          </div>
        </form>
      </mat-step>
      <!-- Second step -->
      <mat-step [stepControl]="secondFormGroup" label="RunList">
        <form [formGroup]="secondFormGroup">
          <div *ngIf="showdrag">
            <app-drag-drop [roles]="rolesList" [serverId]="server" [orgId]="org" id="my-drag" (valueChanged)="dragDropHandler($event)"></app-drag-drop>
          </div>
          <div class="button-bar-box">
            <chef-button tertiary (click)="closeCreateModal()">Cancel</chef-button>
            <button chef-button mat-button matStepperPrevious primary class="primary">Previous</button>
            <button chef-button mat-button matStepperNext primary class="primary" [disabled]="!secondFormGroup?.valid">Next</button>
            <chef-button [disabled]="!secondFormGroup?.valid || conflictError"  primary id="create-button-object-modal" (click)="createRole()">
              <chef-loading-spinner *ngIf="creating"></chef-loading-spinner>
              <span *ngIf="!creating">Create Role</span>
              <span *ngIf="creating">Creating Role...</span>
            </chef-button>
          </div>
        </form>
      </mat-step>
      <!-- Third step -->
      <mat-step [stepControl]="thirdFormGroup" label="Default Attributes">
        <form [formGroup]="thirdFormGroup">
          <chef-form-field>
          <textarea chefInput name="dattr" id="dattr" formControlName="dattr" (change)="onChangeJSON($event)"
            (keyup)="onChangeJSON($event)" [(ngModel)]="default_attr_value"></textarea>
          <chef-error *ngIf="dattrParseError">
            Must be a valid JSON object
          </chef-error>
        </chef-form-field>
          <div class="button-bar-box">
            <chef-button tertiary (click)="closeCreateModal()">Cancel</chef-button>
            <button chef-button mat-button matStepperPrevious primary class="primary" [disabled]="dattrParseError">Previous</button>
            <button chef-button mat-button matStepperNext primary class="primary" [disabled]="!thirdFormGroup?.valid || dattrParseError">Next</button>
            <chef-button [disabled]="!thirdFormGroup?.valid || conflictError"  primary id="create-button-object-modal" (click)="createRole()">
              <chef-loading-spinner *ngIf="creating"></chef-loading-spinner>
              <span *ngIf="!creating">Create Role</span>
              <span *ngIf="creating">Creating Role...</span>
            </chef-button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="fourthFormGroup">
        <form [formGroup]="fourthFormGroup">
          <ng-template matStepLabel>Override Attributes</ng-template>
          <chef-form-field>
          <textarea chefInput name="oattr" id="oattr" formControlName="oattr" autofocus (change)="onChangeJSON($event)"
                (keyup)="onChangeJSON($event)" [(ngModel)]="override_attr_value"></textarea>
              <chef-error *ngIf="oattrParseError">
                Must be a valid JSON object
              </chef-error>
            </chef-form-field>
          <div class="button-bar-box">
            <chef-button tertiary (click)="closeCreateModal()">Cancel</chef-button>
            <button chef-button mat-button matStepperPrevious primary class="primary" [disabled]="oattrParseError">Previous</button>
            <button chef-button mat-button matStepperNext primary class="primary" disabled>Next</button>
            <chef-button [disabled]="!fourthFormGroup?.valid || conflictError"  primary id="create-button-object-modal" (click)="createRole()">
              <chef-loading-spinner *ngIf="creating"></chef-loading-spinner>
              <span *ngIf="!creating">Create Role</span>
              <span *ngIf="creating">Creating role...</span>
            </chef-button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>  
  </div> 
</chef-modal>
